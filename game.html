<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>æ³•è¯­æ€§åˆ«å¿«é—ªç»ˆæç‰ˆ</title>
<style>
  body { font-family: sans-serif; text-align: center; margin-top: 50px; background: #f2f6fa; }
  h1 { color: #333; }
  .word { font-size: 2em; margin: 20px; opacity: 1; transition: opacity 0.5s ease; }
  button { font-size: 1.5em; margin: 10px; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; }
  .btnM { background-color: #4da3ff; color: white; }
  .btnF { background-color: #ff4d94; color: white; }
  .btnStart { background-color: #4CAF50; color: white; }
  #feedback { font-size: 1.2em; margin-top: 15px; }
  #timerBar { width: 80%; height: 10px; background: #ddd; margin: 15px auto; border-radius: 5px; overflow: hidden; }
  #timerFill { height: 10px; background: #4CAF50; width: 0%; }
  .correct { color: green; animation: flashGreen 0.5s ease-in-out; }
  .wrong { color: red; animation: flashRed 0.5s ease-in-out; }
  @keyframes flashGreen { 0%{color:green;}50%{color:lime;}100%{color:green;} }
  @keyframes flashRed { 0%{color:red;}50%{color:orange;}100%{color:red;} }
  #summary { margin-top: 30px; font-size: 1.1em; }
</style>
</head>
<body>

<h1>æ³•è¯­æ€§åˆ«å¿«é—ª ğŸ¯</h1>
<div id="score">å¾—åˆ†: 0</div>
<div class="word" id="word">ç‚¹å‡»å¼€å§‹</div>
<button class="btnM" onclick="choose('M')">é˜³æ€§ (M)</button>
<button class="btnF" onclick="choose('F')">é˜´æ€§ (F)</button>
<br><br>
<button class="btnStart" onclick="startGame('basic')">å¼€å§‹åˆçº§å…³</button>
<button class="btnStart" onclick="startGame('advanced')">æŒ‘æˆ˜é«˜çº§å…³</button>
<div id="feedback"></div>
<div id="timerBar"><div id="timerFill"></div></div>
<div id="summary"></div>

<!-- éŸ³æ•ˆ -->
<audio id="soundCorrect" src="https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg"></audio>
<audio id="soundWrong" src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg"></audio>
<audio id="soundWarning" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg"></audio>

<script>
const basicWords = [
  {text: "madame", gender: "F"},
  {text: "monsieur", gender: "M"},
  {text: "soeur", gender: "F"},
  {text: "ingÃ©nieur", gender: "M"},
  {text: "professeur", gender: "M"},
  {text: "Ã©cole", gender: "F"},
  {text: "an", gender: "M"},
  {text: "rue", gender: "F"},
  {text: "fÃªte", gender: "F"}
];

const advancedWords = basicWords.concat([
  {text: "courage", gender: "M"},
  {text: "plage", gender: "F"},
  {text: "problÃ¨me", gender: "M"},
  {text: "eau", gender: "F"},
  {text: "arbre", gender: "M"}
]);

let wordList = [];
let score = 0;
let round = 0;
let totalRounds = 10;
let currentWord = null;
let wrongList = [];
let timer;
let timeLimit = 5000; // æ¯é¢˜5ç§’
let startTime;

function startGame(mode) {
  wordList = (mode === 'advanced') ? advancedWords : basicWords;
  score = 0;
  round = 0;
  wrongList = [];
  document.getElementById('score').innerText = "å¾—åˆ†: " + score;
  document.getElementById('summary').innerHTML = "";
  nextWord();
  startTime = Date.now();
}

function nextWord() {
  clearInterval(timer);
  if (round >= totalRounds) {
    endGame();
    return;
  }
  round++;
  let wElem = document.getElementById('word');
  wElem.style.opacity = 0;
  setTimeout(() => {
    currentWord = wordList[Math.floor(Math.random()*wordList.length)];
    wElem.style.opacity = 1;
    wElem.innerText = currentWord.text;
  }, 300);
  document.getElementById('feedback').innerText = "";
  startTimer();
}

function startTimer() {
  let elapsed = 0;
  document.getElementById('timerFill').style.width = "100%";
  timer = setInterval(() => {
    elapsed += 100;
    let remaining = timeLimit - elapsed;
    let percentage = (remaining / timeLimit) * 100;
    document.getElementById('timerFill').style.width = percentage + "%";
    if (remaining <= 1500 && remaining > 1400) {
      document.getElementById('soundWarning').play();
    }
    if (remaining <= 0) {
      clearInterval(timer);
      document.getElementById('feedback').innerHTML = `<span class="wrong">â° æ—¶é—´åˆ°ï¼æ­£ç¡®æ˜¯ ${currentWord.gender}</span>`;
      document.getElementById('soundWrong').play();
      wrongList.push(currentWord);
      setTimeout(nextWord, 1000);
    }
  }, 100);
}

function choose(choice) {
  clearInterval(timer);
  if (!currentWord) return;
  if (choice === currentWord.gender) {
    score++;
    document.getElementById('feedback').innerHTML = `<span class="correct">âœ” æ­£ç¡®ï¼</span>`;
    document.getElementById('soundCorrect').play();
  } else {
    document.getElementById('feedback').innerHTML = `<span class="wrong">âŒ é”™è¯¯ï¼æ­£ç¡®æ˜¯ ${currentWord.gender}</span>`;
    document.getElementById('soundWrong').play();
    wrongList.push(currentWord);
  }
  document.getElementById('score').innerText = "å¾—åˆ†: " + score;
  setTimeout(nextWord, 1000);
}

function endGame() {
  let timeUsed = ((Date.now() - startTime) / 1000).toFixed(1);
  document.getElementById('word').innerText = "æ¸¸æˆç»“æŸ!";
  document.getElementById('feedback').innerText = "";
  let wrongText = wrongList.length > 0 
    ? "<b>éœ€è¦å¤ä¹ ï¼š</b><br>" + wrongList.map(w => `${w.text} (${w.gender})`).join(", ") 
    : "ğŸ‰ å…¨éƒ¨ç­”å¯¹ï¼";
  document.getElementById('summary').innerHTML = `
    <p>æ€»åˆ†: ${score} / ${totalRounds}</p>
    <p>æ€»ç”¨æ—¶: ${timeUsed} ç§’</p>
    <p>${wrongText}</p>
    <button class="btnStart" onclick="startGame('basic')">å†ç©åˆçº§å…³</button>
    <button class="btnStart" onclick="startGame('advanced')">æŒ‘æˆ˜é«˜çº§å…³</button>
  `;
}
</script>

</body>
</html>
