<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>æ³•è¯­æ€§åˆ« & å† è¯è®­ç»ƒ - ç®€çº¦æ‰‹æœºç‰ˆæ— é‡å¤é¢˜</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body {
    font-family: 'Segoe UI', sans-serif;
    margin: 0;
    padding: 0;
    background: #f7f7f7;
    color: #333;
    text-align: center;
  }
  h1 {
    font-size: 1.5em;
    padding: 10px;
    background: white;
    margin: 0;
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
  }
  #score { font-size: 1.2em; margin-top: 8px; }
  .word { font-size: 2em; margin: 20px 0; font-weight: bold; }
  button {
    font-size: 1.2em;
    padding: 12px 20px;
    margin: 8px 5px;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    width: 80%;
    max-width: 260px;
  }
  .btnM { background-color: #5ba8ff; color: white; }
  .btnF { background-color: #ff7ca8; color: white; }
  .btnArt { background-color: #b0b0b0; color: white; }
  .btnStart { background-color: #4CAF50; color: white; }
  #continueBtn { background-color: #FFA64D; color: white; display:none; }
  #timerBar {
    width: 90%; height: 14px; background: #ddd; border-radius: 7px;
    overflow: hidden; margin: 10px auto;
  }
  #timerFill {
    height: 14px;
    background: linear-gradient(to right, #8BC34A, #C8E6C9);
    width: 100%;
  }
  #timeLeft { font-size: 1.2em; margin-top: 5px; font-weight: bold; }
  .correct { color: #4CAF50; font-weight: bold; }
  .wrong { color: #f44336; font-weight: bold; }
  #feedback { font-size: 1.2em; margin-top: 10px; min-height: 40px; padding: 0 10px; }
  #summary {
    margin-top: 20px; padding: 10px; font-size: 1em; background: white;
    border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.05);
  }
</style>
</head>
<body>

<h1>æ³•è¯­æ€§åˆ« â¡ å† è¯è®­ç»ƒ ğŸ¯</h1>
<div id="score">å¾—åˆ†: 0</div>
<div class="word" id="word">ç‚¹å‡»å¼€å§‹</div>

<div id="genderBtns">
  <button class="btnM" onclick="chooseGender('M')">é˜³æ€§ (M)</button>
  <button class="btnF" onclick="chooseGender('F')">é˜´æ€§ (F)</button>
</div>

<div id="articleBtns" style="display:none;">
  <button class="btnArt" onclick="chooseArticle('le')">le</button>
  <button class="btnArt" onclick="chooseArticle('la')">la</button>
  <button class="btnArt" onclick="chooseArticle('lâ€™')">lâ€™</button>
</div>

<button id="startBtn" class="btnStart" onclick="startGame()">å¼€å§‹æ¸¸æˆ</button>
<button id="continueBtn" onclick="continueGame()">ç»§ç»­</button>

<div id="feedback"></div>
<div id="timerBar"><div id="timerFill"></div></div>
<div id="timeLeft">5 ç§’</div>
<div id="summary"></div>

<script>
const words = [
  {text: "madame", gender: "F"}, {text: "monsieur", gender: "M"},
  {text: "soeur", gender: "F"}, {text: "ingÃ©nieur", gender: "M"},
  {text: "professeur", gender: "M"}, {text: "Ã©cole", gender: "F"},
  {text: "an", gender: "M"}, {text: "rue", gender: "F"},
  {text: "fÃªte", gender: "F"}, {text: "courage", gender: "M"},
  {text: "plage", gender: "F"}, {text: "problÃ¨me", gender: "M"},
  {text: "eau", gender: "F"}, {text: "arbre", gender: "M"}
];

let score = 0, round = 0, totalRounds = words.length; // ç”¨å…¨éƒ¨è¯æ•°ä¸ºæ€»å›åˆ
let availableWords = [];
let currentWord = null, wrongList = [], timer;
let timeLimit = 5000, phase = 1, chosenGender = null, startTime;

function startGame(){
  score = 0; round = 0; wrongList = [];
  availableWords = [...words]; // æ–°å»ºå¯ç”¨è¯åˆ—è¡¨
  document.getElementById('score').innerText = "å¾—åˆ†: " + score;
  document.getElementById('summary').innerHTML = "";
  document.getElementById('startBtn').style.display = 'none';
  nextWord();
  startTime = Date.now();
}

function nextWord(){
  clearInterval(timer);
  if (availableWords.length === 0) { endGame(); return; }
  round++;
  // éšæœºå–ä¸€ä¸ªå¹¶åˆ é™¤ï¼Œç¡®ä¿ä¸é‡å¤
  let index = Math.floor(Math.random() * availableWords.length);
  currentWord = availableWords.splice(index, 1)[0];

  document.getElementById('word').innerText = currentWord.text;
  document.getElementById('feedback').innerText = "";
  phase = 1; chosenGender = null;
  document.getElementById('genderBtns').style.display = 'block';
  document.getElementById('articleBtns').style.display = 'none';
  document.getElementById('continueBtn').style.display = 'none';
  startTimer();
}

function startTimer(){
  clearInterval(timer);
  let elapsed = 0;
  let timeLeftElem = document.getElementById('timeLeft');
  timeLeftElem.style.color = "#333";
  document.getElementById('timerFill').style.width = "100%";
  timer = setInterval(()=>{
    elapsed += 100;
    let remaining = timeLimit - elapsed;
    let secondsLeft = Math.ceil(remaining / 1000);
    timeLeftElem.textContent = secondsLeft + " ç§’";
    let percentage = (remaining / timeLimit) * 100;
    document.getElementById('timerFill').style.width = percentage + "%";
    if (secondsLeft <= 2 && secondsLeft > 0) timeLeftElem.style.color = "orange";
    if (secondsLeft <= 1) timeLeftElem.style.color = "red";
    if (remaining <= 0){
      clearInterval(timer);
      handleWrong(`â° æ—¶é—´åˆ°ï¼æ­£ç¡®æ˜¯ ${phase===1?currentWord.gender:expectedArticle(currentWord)}`);
    }
  }, 100);
}

function chooseGender(choice){
  clearInterval(timer);
  chosenGender = choice;
  if (choice === currentWord.gender){
    document.getElementById('feedback').innerHTML = "<span class='correct'>âœ” æ€§åˆ«æ­£ç¡®ï¼</span>";
    phase = 2;
    document.getElementById('genderBtns').style.display = 'none';
    document.getElementById('articleBtns').style.display = 'block';
    startTimer();
  } else {
    handleWrong(`âŒ æ€§åˆ«é”™è¯¯ï¼æ­£ç¡®æ˜¯ ${currentWord.gender}`);
  }
}

function expectedArticle(wordObj){
  const first = wordObj.text[0].toLowerCase();
  const vowels = ['a','e','i','o','u','h','Ã¢','Ãª','Ã®','Ã´','Ã»','Ã©','Ã¨','Ã«','Ã¯','Ã¼'];
  if (vowels.includes(first)) return "lâ€™";
  return wordObj.gender === "M" ? "le" : "la";
}

function chooseArticle(choice){
  clearInterval(timer);
  const correctArt = expectedArticle(currentWord);
  if (choice === correctArt){
    document.getElementById('feedback').innerHTML = "<span class='correct'>âœ” å† è¯æ­£ç¡®ï¼</span>";
    score++;
    setTimeout(nextWord, 800);
  } else {
    handleWrong(`âŒ å† è¯é”™è¯¯ï¼æ­£ç¡®æ˜¯ ${correctArt}`);
  }
  document.getElementById('score').innerText = "å¾—åˆ†: " + score;
}

function handleWrong(msg){
  document.getElementById('feedback').innerHTML = `<span class='wrong'>${msg}</span>`;
  wrongList.push(currentWord);
  document.getElementById('continueBtn').style.display = 'inline-block';
}

function continueGame(){
  nextWord();
}

function endGame(){
  let timeUsed = ((Date.now() - startTime) / 1000).toFixed(1);
  document.getElementById('word').innerText = "æ¸¸æˆç»“æŸ!";
  document.getElementById('feedback').innerText = "";
  let wrongText = wrongList.length>0
    ? "<b>éœ€è¦å¤ä¹ ï¼š</b><br>" + wrongList.map(w =>
        `${w.text} (${w.gender}, ${expectedArticle(w)})`).join("<br>")
    : "ğŸ‰ å…¨éƒ¨ç­”å¯¹ï¼";
  document.getElementById('summary').innerHTML = `
    <p>æ€»åˆ†: ${score} / ${totalRounds}</p>
    <p>æ€»ç”¨æ—¶: ${timeUsed} ç§’</p>
    <p>${wrongText}</p>
    <button class='btnStart' onclick="startGame()">å†ç©ä¸€æ¬¡</button>
  `;
}
</script>

</body>
</html>
